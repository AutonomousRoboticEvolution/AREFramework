#!/bin/bash
#SBATCH --job-name=linearComb        # Job name
#SBATCH --mail-type=ALL             # Mail events (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --mail-user=ebb505@york.ac.uk     # Where to send mail  

#SBATCH --mem-per-cpu=1gb 
#SBATCH --time=2:00:00                  # Time limit hrs:min:sec

#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4

#SBATCH --output=edgars_vrep_output_%j.log        # Standard output and error log
#SBATCH --account=elec-arevo-2019         # Project account
#SBATCH --ntasks-per-core=1 #only 1 task per core, must not be more
#SBATCH --ntasks-per-node=1 #only 1 task per node, must not be more
#SBATCH --ntasks-per-socket=1 #guessing here but fairly sure I don't want multiple instances trying to use same socket

echo My working directory is `pwd`
echo Running job on host:
echo -e '\t'`hostname` at `date`
echo
 
module load toolchain/foss/2018b
module load devel/Boost/1.66.0-foss-2018a
module load lang/Python/3.7.2-GCCcore-8.2.0

cd vrep

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/users/ebb505/scratch/vrep:/users/ebb505/scratch/vrep/lib:/users/ebb505/scratch/include
export QT_QPA_PLATFORM='offscreen'

srun -N 1 -n 1 python3 /users/ebb505/scratch/evolutionary_robotics_framework/EvolutionVREP/Cluster/run_cluster.py 3 --vrep /users/ebb505/scratch/vrep/vrep.sh --client /users/ebb505/scratch/evolutionary_robotics_framework/build/EvolutionVREP/ERClient/ERClient --params /users/ebb505/scratch/evolutionary_robotics_framework/EvolutionVREP/experiments/linearCombination/PCparameters.csv --port-start 20000 --xvfb 0

wait
  
echo
echo Job completed at `date`
