#!/bin/bash
#SBATCH --job-name=edgars_vrep        # Job name
#SBATCH --mail-type=END             # Mail events (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --mail-user=ebb505@york.ac.uk     # Where to send mail  

#SBATCH --mem=4gb                        # Job memory request
#SBATCH --time=40:00:00                  # Time limit hrs:min:sec

#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1

#SBATCH --output=edgars_vrep_output_%j.log        # Standard output and error log
#SBATCH --account=elec-arevo-2019         # Project account
#SBATCH --ntasks-per-core=1 #only 1 task per core, must not be more
#SBATCH --ntasks-per-node=1 #only 1 task per node, must not be more
#SBATCH --ntasks-per-socket=1 #guessing here but fairly sure I don't want multiple instances trying to use same socket

echo My working directory is `pwd`
echo Running job on host:
echo -e '\t'`hostname` at `date`
echo
 
module load toolchain/foss/2018b
module load devel/Boost/1.66.0-foss-2018a

cd vrep

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/users/ebb505/scratch/vrep:/users/ebb505/scratch/vrep/lib:/users/ebb505/scratch/include

cp ../parameters.csv ../evolutionary_robotics_framework/EvolutionVREP/experiments/morphology/
sed -i '/\#seed,int,/ s/$/1/' ../evolutionary_robotics_framework/EvolutionVREP/experiments/morphology/parameters.csv
srun -N 1 -n 1 xvfb-run -a -s "-screen 0 1024x768x24" ./vrep.sh -h -g/users/ebb505/scratch/evolutionary_robotics_framework/EvolutionVREP/experiments/morphology/parameters.csv &

cp ../parameters.csv ../evolutionary_robotics_framework/EvolutionVREP/experiments/morphology/
sed -i '/\#seed,int,/ s/$/2/' ../evolutionary_robotics_framework/EvolutionVREP/experiments/morphology/parameters.csv
srun -N 1 -n 1 xvfb-run -a -s "-screen 0 1024x768x24" ./vrep.sh -h -g/users/ebb505/scratch/evolutionary_robotics_framework/EvolutionVREP/experiments/morphology/parameters.csv &


wait
  
echo
echo Job completed at `date`
